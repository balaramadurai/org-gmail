#+TITLE: org-gmail: Fetch Gmail Threads into Org Mode

* Introduction

org-gmail is a package for Emacs that allows you to fetch entire Gmail threads or individual messages and save them as entries in your Org mode files. It uses the Gmail API via a companion Python script.

* Features

- Create and delete labels in Gmail.
- Download all emails with a specific label, chosen from a list fetched directly from Gmail.
- Sync all previously downloaded labels to fetch new emails. This works by finding all `:LABEL:` properties in your agenda files, so you can refile and reorganize your emails without breaking the sync.
- Edit a thread's label at point, updating it in Gmail and across all your Org files.
- Bulk move all threads from one label to another. If the destination label doesn't exist, it will be created for you. This updates both Gmail and all corresponding `:LABEL:` properties in your Org files.
- Download new messages for a specific thread.
- Insert new messages directly after the existing thread in your Org file.
- Move messages or entire threads to the trash in Gmail.
- Sync and find duplicate email IDs across your agenda files.
- Create and insert internal links (`org-gmail:`) between email entries.
- A Hydra menu for quick access to all commands.

* Installation

** 1. Python Dependencies

This package relies on a Python script with a few dependencies. You can install them using pip:

#+BEGIN_SRC sh
pip install --upgrade google-api-python-client google-auth-httplib2 google-auth-oauthlib html2text pytz
#+END_SRC

** 2. Gmail API Credentials

You'll need to enable the Gmail API and download a `credentials.json` file.

1. Go to the [[https://console.developers.google.com/][Google Cloud Console]].
2. Create a new project.
3. Enable the "Gmail API" for your project.
4. Create credentials for a "Desktop app".
5. Download the `credentials.json` file.

** 3. Emacs Package Installation

This package is designed to be installed with `straight.el`. Add the following to your Emacs configuration. Make sure to replace `"your-username/your-repo-name"` with your actual GitHub repository details.

#+BEGIN_SRC emacs-lisp
  (use-package org-gmail
    :straight (org-gmail :type git :host github :repo "balaramadurai/org-gmail")
    :commands (org-gmail-create-label
               org-gmail-delete-label
               org-gmail-download-by-label
               org-gmail-download-at-point
               org-gmail-sync-labels
               org-gmail-sync-email-ids
               org-gmail-trash-at-point
               org-gmail-copy-link-at-point
               org-gmail-insert-link
               org-gmail-edit-label-at-point
               org-gmail-bulk-move-labels
               org-gmail-hydra)
    :config
    (setq org-gmail-org-file "~/Documents/0Inbox/index.org")
    (setq org-gmail-credentials-file "~/path/to/your/credentials.json")
    (setq org-gmail-python-script "gmail_label_manager.py")
    (setq org-gmail-date-drawer "org-gmail")
    (setq org-gmail-process-timeout 300)
    )
#+END_SRC

* Usage

You can call the functions individually or use the Hydra menu for quick access.

- `M-x org-gmail-hydra`: Show the Hydra menu with single-key shortcuts.

** Main Commands:
- `M-x org-gmail-create-label`: Create a new label in Gmail.
- `M-x org-gmail-delete-label`: Delete a label from Gmail.
- `M-x org-gmail-download-by-label`: Fetches a list of your Gmail labels and prompts you to select one to download.
- `M-x org-gmail-sync-labels`: Finds all labels you have previously downloaded (by looking for `:LABEL:` properties) and fetches new emails for them.
- `M-x org-gmail-edit-label-at-point`: Move the thread at point to a new label by editing the current label name.
- `M-x org-gmail-bulk-move-labels`: Move all threads from one label to another.
- `M-x org-gmail-download-at-point`: Download new messages for the thread at point.
- `M-x org-gmail-sync-email-ids`: Sync and find duplicate email IDs.
- `M-x org-gmail-trash-at-point`: Move the email or thread at point to the trash.

** Link Commands:
- `M-x org-gmail-copy-link-at-point`: Copies a `org-gmail:` link for the email at point.
- `M-x org-gmail-insert-link`: Inserts a `org-gmail:` link to an email you select from a list.
